!function(root,factory){"function"==typeof define&&define.amd?define("smoothScroll",factory(root)):"object"==typeof exports?module.exports=factory(root):root.smoothScroll=factory(root)}(window||this,function(root){"use strict";var settings,eventTimeout,fixedHeader,smoothScroll={},supports=!!document.querySelector&&!!root.addEventListener,defaults={speed:500,easing:"easeInOutCubic",offset:0,updateURL:!0,callbackBefore:function(){},callbackAfter:function(){}},forEach=function(collection,callback,scope){if("[object Object]"===Object.prototype.toString.call(collection))for(var prop in collection)Object.prototype.hasOwnProperty.call(collection,prop)&&callback.call(scope,collection[prop],prop,collection);else for(var i=0,len=collection.length;len>i;i++)callback.call(scope,collection[i],i,collection)},extend=function(defaults,options){var extended={};return forEach(defaults,function(value,prop){extended[prop]=defaults[prop]}),forEach(options,function(value,prop){extended[prop]=options[prop]}),extended},getClosest=function(elem,selector){for(var firstChar=selector.charAt(0);elem&&elem!==document;elem=elem.parentNode)if("."===firstChar){if(elem.classList.contains(selector.substr(1)))return elem}else if("#"===firstChar){if(elem.id===selector.substr(1))return elem}else if("["===firstChar&&elem.hasAttribute(selector.substr(1,selector.length-2)))return elem;return!1},getHeight=function(elem){return Math.max(elem.scrollHeight,elem.offsetHeight,elem.clientHeight)},escapeCharacters=function(id){for(var codeUnit,string=String(id),length=string.length,index=-1,result="",firstCodeUnit=string.charCodeAt(0);++index<length;){if(codeUnit=string.charCodeAt(index),0===codeUnit)throw new InvalidCharacterError("Invalid character: the input contains U+0000.");result+=codeUnit>=1&&31>=codeUnit||127==codeUnit||0===index&&codeUnit>=48&&57>=codeUnit||1===index&&codeUnit>=48&&57>=codeUnit&&45===firstCodeUnit?"\\"+codeUnit.toString(16)+" ":codeUnit>=128||45===codeUnit||95===codeUnit||codeUnit>=48&&57>=codeUnit||codeUnit>=65&&90>=codeUnit||codeUnit>=97&&122>=codeUnit?string.charAt(index):"\\"+string.charAt(index)}return result},easingPattern=function(type,time){var pattern;return"easeInQuad"===type&&(pattern=time*time),"easeOutQuad"===type&&(pattern=time*(2-time)),"easeInOutQuad"===type&&(pattern=.5>time?2*time*time:-1+(4-2*time)*time),"easeInCubic"===type&&(pattern=time*time*time),"easeOutCubic"===type&&(pattern=--time*time*time+1),"easeInOutCubic"===type&&(pattern=.5>time?4*time*time*time:(time-1)*(2*time-2)*(2*time-2)+1),"easeInQuart"===type&&(pattern=time*time*time*time),"easeOutQuart"===type&&(pattern=1- --time*time*time*time),"easeInOutQuart"===type&&(pattern=.5>time?8*time*time*time*time:1-8*--time*time*time*time),"easeInQuint"===type&&(pattern=time*time*time*time*time),"easeOutQuint"===type&&(pattern=1+--time*time*time*time*time),"easeInOutQuint"===type&&(pattern=.5>time?16*time*time*time*time*time:1+16*--time*time*time*time*time),pattern||time},getEndLocation=function(anchor,headerHeight,offset){var location=0;if(anchor.offsetParent)do location+=anchor.offsetTop,anchor=anchor.offsetParent;while(anchor);return location=location-headerHeight-offset,location>=0?location:0},getDocumentHeight=function(){return Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight)},getDataOptions=function(options){return options&&"object"==typeof JSON&&"function"==typeof JSON.parse?JSON.parse(options):{}},updateUrl=function(anchor,url){history.pushState&&(url||"true"===url)&&history.pushState(null,null,[root.location.protocol,"//",root.location.host,root.location.pathname,root.location.search,anchor].join(""))};smoothScroll.animateScroll=function(toggle,anchor,options){var settings=extend(settings||defaults,options||{}),overrides=getDataOptions(toggle?toggle.getAttribute("data-options"):null);settings=extend(settings,overrides),anchor="#"+escapeCharacters(anchor.substr(1));var anchorElem="#"===anchor?document.documentElement:document.querySelector(anchor),startLocation=root.pageYOffset;fixedHeader||(fixedHeader=document.querySelector("[data-scroll-header]"));var animationInterval,percentage,position,headerHeight=null===fixedHeader?0:getHeight(fixedHeader)+fixedHeader.offsetTop,endLocation=getEndLocation(anchorElem,headerHeight,parseInt(settings.offset,10)),distance=endLocation-startLocation,documentHeight=getDocumentHeight(),timeLapsed=0;updateUrl(anchor,settings.updateURL);var stopAnimateScroll=function(position,endLocation,animationInterval){var currentLocation=root.pageYOffset;(position==endLocation||currentLocation==endLocation||root.innerHeight+currentLocation>=documentHeight)&&(clearInterval(animationInterval),anchorElem.focus(),settings.callbackAfter(toggle,anchor))},loopAnimateScroll=function(){timeLapsed+=16,percentage=timeLapsed/parseInt(settings.speed,10),percentage=percentage>1?1:percentage,position=startLocation+distance*easingPattern(settings.easing,percentage),root.scrollTo(0,Math.floor(position)),stopAnimateScroll(position,endLocation,animationInterval)},startAnimateScroll=function(){settings.callbackBefore(toggle,anchor),animationInterval=setInterval(loopAnimateScroll,16)};0===root.pageYOffset&&root.scrollTo(0,0),startAnimateScroll()};var eventHandler=function(event){var toggle=getClosest(event.target,"[data-scroll]");toggle&&"a"===toggle.tagName.toLowerCase()&&(event.preventDefault(),smoothScroll.animateScroll(toggle,toggle.hash,settings))},eventThrottler=function(event){eventTimeout||(eventTimeout=setTimeout(function(){eventTimeout=null,headerHeight=null===fixedHeader?0:getHeight(fixedHeader)+fixedHeader.offsetTop},66))};return smoothScroll.destroy=function(){settings&&(document.removeEventListener("click",eventHandler,!1),root.removeEventListener("resize",eventThrottler,!1),settings=null,eventTimeout=null,fixedHeader=null)},smoothScroll.init=function(options){supports&&(smoothScroll.destroy(),settings=extend(defaults,options||{}),fixedHeader=document.querySelector("[data-scroll-header]"),document.addEventListener("click",eventHandler,!1),fixedHeader&&root.addEventListener("resize",eventThrottler,!1))},smoothScroll});